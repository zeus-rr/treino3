<!doctype html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SISTEMA DE TREINO PREMIUM</title>
    <link rel="icon" href="https://zeus-rr.github.io/treino/icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { 
                        'primary': 'var(--primary-color)', 
                        'pink-hot': '#FF1493',
                        'bg-dark': '#0b0f1a' 
                    } 
                } 
            }
        }
    </script>
    <style>
        :root { --primary-color: #FF1493; --primary-rgb: 255, 20, 147; }
        body { transition: background-color 0.3s ease; }
        .is-conjugated { margin-bottom: -1rem !important; border-bottom-left-radius: 0 !important; border-bottom-right-radius: 0 !important; border-bottom: 2px dashed var(--primary-color) !important; position: relative; z-index: 10; }
        .is-conjugated + .workout-item { border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; }
        .is-student-mode .admin-ui, .is-student-mode .edit-btn, .is-student-mode #btnTutorial, .is-student-mode .drag-handle { display: none !important; }
        .is-student-mode main { grid-template-columns: 1fr !important; max-width: 800px; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }
        .category-content { display: none; transition: all 0.3s ease; }
        .category-content.active { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .pink-bold { color: var(--primary-color) !important; font-weight: 900 !important; }
        .btn-whatsapp-float { position: fixed; bottom: 20px; right: 20px; background-color: #25d366; color: white; padding: 12px 20px; border-radius: 50px; font-weight: 900; text-transform: uppercase; font-size: 11px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; z-index: 1000; transition: all 0.3s ease; }
        #adminModal { display: none; }
        #adminModal.active { display: flex; }
        .profile-upload { position: relative; width: 80px; height: 80px; border-radius: 20px; overflow: hidden; background: #f1f5f9; cursor: pointer; border: 2px dashed #cbd5e1; }
        .profile-upload img { width: 100%; height: 100%; object-fit: cover; }
        .dark .profile-upload { background: #1e293b; border-color: #334155; }
        @media print { .no-print { display: none !important; } body { background: white !important; } }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0b0f1a] text-slate-800 dark:text-slate-100 font-sans antialiased flex flex-col min-h-screen">

    <a id="waLink" href="#" target="_blank" class="btn-whatsapp-float no-print">
        <span>Falar com o Professor</span> üí¨
    </a>

    <div id="adminModal" class="fixed inset-0 z-[110] bg-slate-900/95 backdrop-blur-md p-4 items-center justify-center">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-[2.5rem] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800">
            <div class="p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                <h2 class="text-xl font-black uppercase pink-bold">Configura√ß√µes</h2>
                <button onclick="toggleAdmin()" class="text-slate-400 hover:text-red-500 font-bold text-2xl">&times;</button>
            </div>
            <div class="p-8 space-y-5 overflow-y-auto max-h-[70vh] custom-scrollbar">
                <div class="flex items-center gap-4 bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl">
                    <div class="profile-upload" onclick="document.getElementById('profPhotoInput').click()">
                        <img id="profPhotoPreview" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
                        <input type="file" id="profPhotoInput" hidden accept="image/*" onchange="compressAndUpload(this, 'profPhoto')">
                    </div>
                    <div>
                        <p class="text-xs font-bold uppercase opacity-60">Sua Foto</p>
                        <p class="text-[10px] opacity-50">Toque para trocar a sua foto.</p>
                    </div>
                </div>
                <input type="text" id="profNameInput" placeholder="Seu Nome" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold">
                <input type="text" id="profPhoneInput" placeholder="WhatsApp (55...)" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold">
                <input type="color" id="profColorInput" class="w-full h-12 rounded-xl mt-1 cursor-pointer bg-transparent border-none">
                <button onclick="saveAdminData()" class="w-full bg-pink-hot text-white py-4 rounded-2xl font-black uppercase text-sm shadow-lg">Salvar Tudo</button>
            </div>
        </div>
    </div>

    <header class="p-4 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img id="profHeaderPhoto" src="" class="w-10 h-10 rounded-full object-cover border-2 border-primary hidden sm:block">
                <h1 id="brandName" class="text-lg italic uppercase tracking-tighter pink-bold cursor-pointer" onclick="toggleAdmin()">PERSONAL</h1>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleAdmin()" class="admin-ui bg-slate-100 dark:bg-slate-800 p-2.5 rounded-xl border border-slate-200 dark:border-slate-700">‚öôÔ∏è</button>
                <button onclick="toggleTheme()" class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                    <span class="dark:hidden">üåô</span><span class="hidden dark:inline">‚òÄÔ∏è</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-8 flex-grow w-full">
        <aside class="lg:col-span-4 space-y-6 admin-ui">
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <h3 class="text-xs font-black uppercase mb-4 text-pink-hot">Dados do Aluno</h3>
                <div class="flex justify-center mb-6">
                    <div class="relative group" onclick="document.getElementById('studentPhotoInput').click()">
                        <div class="w-24 h-24 rounded-[2.5rem] overflow-hidden bg-slate-100 dark:bg-slate-800 border-2 border-dashed border-slate-300 dark:border-slate-700 group-hover:border-pink-hot transition-all cursor-pointer">
                            <img id="studentPhotoPreview" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-full h-full object-cover">
                        </div>
                        <input type="file" id="studentPhotoInput" hidden accept="image/*" onchange="compressAndUpload(this, 'studentPhoto')">
                    </div>
                </div>
                <input type="text" id="studentName" oninput="updateHeader()" placeholder="Nome do Aluno" class="w-full bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border-none outline-none font-bold mb-4">
                <select id="daySelector" class="w-full bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border-none outline-none font-bold text-sm appearance-none">
                    <option value="segunda">Segunda-feira</option>
                    <option value="terca">Ter√ßa-feira</option>
                    <option value="quarta">Quarta-feira</option>
                    <option value="quinta">Quinta-feira</option>
                    <option value="sexta">Sexta-feira</option>
                    <option value="sabado">S√°bado</option>
                </select>
            </div>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <input type="text" id="searchEx" placeholder="Buscar exerc√≠cio..." class="w-full bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl mb-4 text-sm outline-none">
                <div id="accordionLib" class="space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </aside>

        <section class="lg:col-span-8 space-y-6">
            <div id="studentHeaderView" class="hidden flex-col items-center text-center p-8 bg-white dark:bg-slate-900 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-sm mb-4">
                <img id="studentViewPhoto" src="" class="w-28 h-28 rounded-[2.5rem] object-cover mb-4 border-4 border-primary shadow-2xl">
                <h2 id="studentViewName" class="text-3xl font-black pink-bold uppercase italic">NOME DO ALUNO</h2>
            </div>

            <div class="flex flex-wrap gap-2 no-print">
                <button onclick="sendWhatsApp()" class="bg-green-600 text-white px-6 py-3.5 rounded-2xl font-black text-[10px] uppercase shadow-lg admin-ui">Enviar p/ Aluno üì±</button>
                <button id="btnCopy" onclick="generateLink()" class="bg-pink-hot text-white px-6 py-3.5 rounded-2xl font-black text-[10px] uppercase shadow-lg admin-ui">Copiar Link üîó</button>
                <button onclick="window.print()" class="bg-slate-800 text-white px-6 py-3.5 rounded-2xl font-black text-[10px] uppercase shadow-lg">PDF üìÑ</button>
            </div>

            <div id="weekDisplay" class="space-y-8"></div>
        </section>
    </main>

    <script>
        const exerciseLibrary = {
            "Peito": ["Supino Reto Barra", "Supino Inclinado Halteres", "Crucifixo", "Peck Deck", "Crossover"],
            "Costas": ["Puxada Frente", "Remada Baixa", "Remada Unilateral", "Pulldown", "Levantamento Terra"],
            "Pernas": ["Agachamento Livre", "Leg Press 45", "Extensora", "Mesa Flexora", "Stiff", "Afundo"],
            "Ombros": ["Desenvolvimento", "Eleva√ß√£o Lateral", "Eleva√ß√£o Frontal", "Crucifixo Inverso"],
            "B√≠ceps": ["Rosca Direta", "Rosca Martelo", "Rosca Scott"],
            "Tr√≠ceps": ["Tr√≠ceps Pulley", "Tr√≠ceps Corda", "Tr√≠ceps Testa"],
            "Core/Cardio": ["Abdominal Supra", "Prancha", "Esteira", "Bicicleta"]
        };

        let workoutData = { student: "", studentPhoto: "", days: { segunda: [], terca: [], quarta: [], quinta: [], sexta: [], sabado: [] } };
        let adminSettings = { profName: "PERSONAL", profPhone: "55", profColor: "#FF1493", profPhoto: "" };

        function init() {
            const savedAdmin = localStorage.getItem('jaque_admin_v4');
            if(savedAdmin) adminSettings = JSON.parse(savedAdmin);
            
            renderLibrary();
            const urlParams = new URLSearchParams(window.location.search);
            const alunoData = urlParams.get('aluno');
            
            if (alunoData) {
                try {
                    const decoded = JSON.parse(decodeURIComponent(escape(atob(alunoData))));
                    workoutData = decoded;
                    document.body.classList.add('is-student-mode');
                    document.getElementById('studentHeaderView').classList.replace('hidden', 'flex');
                    document.getElementById('studentViewPhoto').src = workoutData.studentPhoto || "";
                    document.getElementById('studentViewName').innerText = workoutData.student;
                } catch(e) { load(); }
            } else { load(); }
            
            applyAdmin();
            render();
        }

        // --- COMPRESSOR DE IMAGEM (A CHAVE PARA O SUCESSO) ---
        function compressAndUpload(input, targetKey) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Tamanho min√∫sculo para caber na URL (60x60 pixels)
                    const size = 60; 
                    canvas.width = size;
                    canvas.height = size;
                    
                    // Desenha imagem quadrada proporcional
                    ctx.drawImage(img, 0, 0, size, size);
                    
                    // Qualidade baix√≠ssima para reduzir caracteres
                    const compressed = canvas.toDataURL('image/jpeg', 0.1);

                    if (targetKey === 'profPhoto') {
                        adminSettings.profPhoto = compressed;
                        document.getElementById('profPhotoPreview').src = compressed;
                    } else {
                        workoutData.studentPhoto = compressed;
                        document.getElementById('studentPhotoPreview').src = compressed;
                        save();
                    }
                    applyAdmin();
                    render();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function getGeneratedURL() {
            const jsonStr = btoa(unescape(encodeURIComponent(JSON.stringify(workoutData))));
            const color = adminSettings.profColor.replace('#', '');
            return `${window.location.origin}${window.location.pathname}?aluno=${jsonStr}&p=${encodeURIComponent(adminSettings.profName)}&c=${color}`;
        }

        function sendWhatsApp() {
            const url = getGeneratedURL();
            if(url.length > 4000) {
                alert("O treino est√° muito grande (muitos exerc√≠cios). Remova alguns ou a foto para enviar via WhatsApp.");
                return;
            }
            const text = encodeURIComponent(`Ol√° ${workoutData.student}, seu treino est√° pronto: ${url}`);
            window.open(`https://api.whatsapp.com/send?text=${text}`, '_blank');
        }

        function generateLink() {
            const url = getGeneratedURL();
            navigator.clipboard.writeText(url);
            const btn = document.getElementById('btnCopy');
            btn.innerText = "COPIADO! ‚úÖ";
            setTimeout(() => btn.innerText = "Copiar Link üîó", 2000);
        }

        // Fun√ß√µes de Suporte
        function toggleAdmin() { document.getElementById('adminModal').classList.toggle('active'); }
        function saveAdminData() {
            adminSettings.profName = document.getElementById('profNameInput').value;
            adminSettings.profPhone = document.getElementById('profPhoneInput').value.replace(/\D/g,'');
            adminSettings.profColor = document.getElementById('profColorInput').value;
            localStorage.setItem('jaque_admin_v4', JSON.stringify(adminSettings));
            applyAdmin(); toggleAdmin();
        }
        function applyAdmin() {
            document.documentElement.style.setProperty('--primary-color', adminSettings.profColor);
            document.getElementById('profHeaderPhoto').src = adminSettings.profPhoto;
            if(adminSettings.profPhoto) document.getElementById('profHeaderPhoto').classList.remove('hidden');
            document.getElementById('brandName').innerText = `PERSONAL ${adminSettings.profName}`;
            document.getElementById('waLink').href = `https://wa.me/${adminSettings.profPhone}`;
        }
        function renderLibrary() {
            const container = document.getElementById('accordionLib');
            Object.keys(exerciseLibrary).forEach(cat => {
                const div = document.createElement('div');
                div.innerHTML = `<button onclick="this.nextElementSibling.classList.toggle('active')" class="w-full p-3 text-left font-black text-[10px] uppercase opacity-50">${cat}</button>
                <div class="category-content p-2 space-y-1">${exerciseLibrary[cat].map(ex => `<div onclick="addEx('${ex}')" class="p-2 text-xs font-bold hover:bg-pink-hot/10 rounded-lg cursor-pointer">${ex}</div>`).join('')}</div>`;
                container.appendChild(div);
            });
        }
        function addEx(name) { 
            const day = document.getElementById('daySelector').value;
            workoutData.days[day].push({ n: name, r: "3x12", w: "", bi: false });
            save(); render(); 
        }
        function render() {
            const container = document.getElementById('weekDisplay');
            container.innerHTML = "";
            Object.keys(workoutData.days).forEach(day => {
                if(workoutData.days[day].length === 0) return;
                let html = `<div class="p-4 bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800">
                    <h2 class="pink-bold uppercase font-black mb-4">${day}</h2>`;
                workoutData.days[day].forEach((ex, i) => {
                    html += `<div class="flex justify-between items-center mb-2 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl">
                        <span class="text-xs font-black uppercase">${ex.n}</span>
                        <div class="flex gap-2">
                            <input type="text" value="${ex.r}" oninput="workoutData.days['${day}'][${i}].r=this.value;save()" class="w-12 text-center bg-white dark:bg-slate-800 rounded-lg text-[10px] font-bold p-1">
                            <button onclick="workoutData.days['${day}'].splice(${i},1);save();render()" class="admin-ui text-red-500">‚úï</button>
                        </div>
                    </div>`;
                });
                container.innerHTML += html + `</div>`;
            });
        }
        function updateHeader() { workoutData.student = document.getElementById('studentName').value; save(); }
        function save() { localStorage.setItem('jaque_workout_v4', JSON.stringify(workoutData)); }
        function load() { const s = localStorage.getItem('jaque_workout_v4'); if(s) workoutData = JSON.parse(s); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        window.onload = init;
    </script>
</body>
</html>
